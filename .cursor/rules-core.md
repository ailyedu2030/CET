# core - æ‰©å±•è§„åˆ™

## ğŸ“‹ æ¥æº: intelligent-agent-coding-guidelines.md

# æ™ºèƒ½ä½“ç¼–ç æŒ‡å¯¼åŸåˆ™
## ğŸ¯ æ ¸å¿ƒé—®é¢˜è§£å†³æ–¹æ¡ˆ
### é—®é¢˜æè¿°
### è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ
## ğŸ“ å•ä½“æ¶æ„æ¨¡å—åŒ–è§„èŒƒ
### æ ‡å‡†ç›®å½•ç»“æ„
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ frontend/                    # å‰ç«¯åº”ç”¨ï¼ˆReact + TypeScriptï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/         # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ stores/             # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api/                # APIè°ƒç”¨
â”‚   â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ package.json            # å‰ç«¯ä¾èµ–
```
### æ¨¡å—å†…éƒ¨ç»“æ„
```
app/{module-name}/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ api/                        # APIè·¯ç”±
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ {domain}_endpoints.py
â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹â­
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ {domain}_models.py
```
## ğŸš¨ æ™ºèƒ½ä½“ç¼–ç å‰ç½®æ£€æŸ¥æ¸…å•
### 1. ç¡®å®šä¸šåŠ¡é¢†åŸŸ
```
æ–‡ä»¶åˆ›å»ºå‰å¿…é¡»å›ç­”:
  - è¿™ä¸ªæ–‡ä»¶å±äºå“ªä¸ªä¸šåŠ¡é¢†åŸŸï¼Ÿ
  - åº”è¯¥æ”¾åœ¨å“ªä¸ªå¾®æœåŠ¡ä¸‹ï¼Ÿ
  - æ–‡ä»¶ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ(API/æœåŠ¡/æ¨¡å‹/æµ‹è¯•/é…ç½®)
```
### 2. æ¨¡å—å½’å±åˆ¤æ–­
```
ç”¨æˆ·ç®¡ç†æ¨¡å— (app/users/):
  å…³é”®è¯: [user_service, authentication, login, register, auth, permission]
  èŒè´£: ç”¨æˆ·è®¤è¯ã€æƒé™ç®¡ç†ã€ç”¨æˆ·ä¿¡æ¯ã€æ³¨å†Œå®¡æ ¸

AIé›†æˆæ¨¡å— (app/ai/):
  å…³é”®è¯: [deepseek, openai, ai_service, temperature, llm, gpt, grading]
  èŒè´£: AIæ¨¡å‹è°ƒç”¨ã€æ™ºèƒ½åˆ†æã€å†…å®¹ç”Ÿæˆã€æ™ºèƒ½æ‰¹æ”¹

è¯¾ç¨‹ç®¡ç†æ¨¡å— (app/courses/):
  å…³é”®è¯: [course_service, curriculum, lesson, syllabus, class, teaching]
```
### 3. æ–‡ä»¶ç±»å‹åˆ¤æ–­
```
APIç«¯ç‚¹æ–‡ä»¶:
  ä½ç½®: app/api/v1/
  ç‰¹å¾: router, APIRouter, @app.get, @app.post
  å‘½å: {domain}_endpoints.py

ä¸šåŠ¡æœåŠ¡æ–‡ä»¶:
  ä½ç½®: app/services/
  ç‰¹å¾: class.*Service, business logic
  å‘½å: {domain}_service.py

```
## âŒ ç¦æ­¢çš„é”™è¯¯ä½ç½®
### ç»å¯¹ä¸è¦åˆ›å»ºçš„ä½ç½®
```
é”™è¯¯ä½ç½®åˆ—è¡¨:
  - app/services/          # æ ¹ç›®å½•appä¸‹
  - backend/app/services/  # ä¸»åç«¯æœåŠ¡ä¸‹
  - tests/ai_service/      # æ ¹ç›®å½•testsä¸‹
  - tests/user_service/    # æ ¹ç›®å½•testsä¸‹
  - tests/course_service/  # æ ¹ç›®å½•testsä¸‹
  - tests/training_service/ # æ ¹ç›®å½•testsä¸‹

æ­£ç¡®ä½ç½®å¯¹åº”:
  - services/ai-service/app/services/
```
## ğŸ” é‡å¤åŠŸèƒ½æ£€æµ‹
### æ£€æµ‹è§„åˆ™
```
é‡å¤ç±»æ£€æµ‹:
  æ¨¡å¼: class.*Service
  æ£€æŸ¥: ç›¸åŒç±»ååœ¨å¤šä¸ªæ–‡ä»¶ä¸­å®šä¹‰

é‡å¤å‡½æ•°æ£€æµ‹:
  æ¨¡å¼: def.*service, async def.*service
  æ£€æŸ¥: ç›¸ä¼¼åŠŸèƒ½çš„å‡½æ•°é‡å¤å®ç°

é‡å¤APIæ£€æµ‹:
  æ¨¡å¼: @router.post, @router.get
```
### é¿å…é‡å¤çš„ç­–ç•¥
```
åˆ›å»ºå‰æ£€æŸ¥:
  1. æœç´¢é¡¹ç›®ä¸­æ˜¯å¦å·²æœ‰ç±»ä¼¼åŠŸèƒ½
  2. æ£€æŸ¥ç›¸åŒç±»åæˆ–å‡½æ•°å
  3. éªŒè¯APIè·¯å¾„æ˜¯å¦å†²çª
  4. ç¡®è®¤ä¸šåŠ¡é€»è¾‘æ˜¯å¦é‡å¤

é‡æ„å»ºè®®:
  1. åˆå¹¶ç›¸ä¼¼åŠŸèƒ½çš„ç±»
  2. æå–å…¬å…±é€»è¾‘åˆ°åŸºç±»
  3. ä½¿ç”¨ç»§æ‰¿å‡å°‘ä»£ç é‡å¤
```
## ğŸ› ï¸ è‡ªåŠ¨åŒ–éªŒè¯å·¥å…·
### 1. HookéªŒè¯å™¨
```
æ–‡ä»¶: .kiro/hooks/directory-structure-validator.kiro.hook
åŠŸèƒ½:
  - å®æ—¶æ£€æµ‹æ–‡ä»¶åˆ›å»ºä½ç½®
  - éªŒè¯æœåŠ¡è¾¹ç•Œ
  - æ£€æŸ¥é‡å¤åŠŸèƒ½
  - æä¾›ä¿®æ­£å»ºè®®
```
### 2. ç»“æ„éªŒè¯è„šæœ¬
```
æ–‡ä»¶: scripts/validate_project_structure.py
åŠŸèƒ½:
  - å…¨é¢æ£€æŸ¥é¡¹ç›®ç»“æ„
  - ç”Ÿæˆè¯¦ç»†éªŒè¯æŠ¥å‘Š
  - æä¾›è‡ªåŠ¨ä¿®å¤å»ºè®®
  - å®šæœŸç»“æ„å¥åº·æ£€æŸ¥
```
### 3. ç®€åŒ–æ£€æŸ¥è„šæœ¬
```
æ–‡ä»¶: scripts/check_structure.py
åŠŸèƒ½:
  - å¿«é€Ÿç»“æ„éªŒè¯
  - å®æ—¶é—®é¢˜æ£€æµ‹
  - ç®€æ´çš„æŠ¥å‘Šè¾“å‡º
  - CI/CDé›†æˆæ”¯æŒ
```
## ğŸ“‹ æ™ºèƒ½ä½“ç¼–ç å·¥ä½œæµ
### æ ‡å‡†å·¥ä½œæµç¨‹
```
graph TD
    A[éœ€è¦åˆ›å»ºæ–‡ä»¶] --> B[ç¡®å®šä¸šåŠ¡é¢†åŸŸ]
    B --> C[é€‰æ‹©ç›®æ ‡å¾®æœåŠ¡]
    C --> D[ç¡®å®šæ–‡ä»¶ç±»å‹]
    D --> E[æ£€æŸ¥ç›®å½•ç»“æ„]
    E --> F[æœç´¢é‡å¤åŠŸèƒ½]
    F --> G{å‘ç°é‡å¤?}
    G -->|æ˜¯| H[é‡æ„æˆ–åˆå¹¶]
    G -->|å¦| I[åˆ›å»ºæ–‡ä»¶]
    H --> I
```
### æ£€æŸ¥å‘½ä»¤
```
# å¿«é€Ÿç»“æ„æ£€æŸ¥
python3 scripts/check_structure.py

# è¯¦ç»†éªŒè¯æŠ¥å‘Š
python3 scripts/validate_project_structure.py

# æŸ¥çœ‹éªŒè¯æŠ¥å‘Š
cat project_structure_report.json
```

## ğŸ“‹ æ¥æº: directory-structure-guidelines.md

# ç›®å½•ç»“æ„æŒ‡å¯¼åŸåˆ™
## ğŸ¯ æ ¸å¿ƒåŸåˆ™
### 1. å•ä½“æ¶æ„æ¨¡å—åŒ–è®¾è®¡
### 2. æ¨¡å—è¾¹ç•Œæ¸…æ™°
æ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šçš„ä¸šåŠ¡é¢†åŸŸï¼Œæ–‡ä»¶å¿…é¡»æ”¾åœ¨å¯¹åº”æ¨¡å—çš„ç›®å½•ä¸‹ã€‚
## ğŸ“ æ ‡å‡†ç›®å½•ç»“æ„
### å•ä½“æ¶æ„æ ¹ç›®å½•ç»“æ„
```
/
â”œâ”€â”€ frontend/                    # å‰ç«¯åº”ç”¨ï¼ˆReact + TypeScriptï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/         # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ stores/             # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api/                # APIè°ƒç”¨
â”‚   â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ public/                 # é™æ€èµ„æº
```
### æ¨¡å—æ ‡å‡†ç»“æ„
```
app/{module-name}/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ api/                        # APIè·¯ç”±
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ {domain}_endpoints.py
â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ {domain}_models.py
```
## ğŸš¨ å•ä½“æ¶æ„æ¨¡å—æ–‡ä»¶æ”¾ç½®è§„åˆ™
### åº”ç”¨æ ¸å¿ƒæ–‡ä»¶è§„åˆ™
```
åº”ç”¨æ ¸å¿ƒæ–‡ä»¶ä½ç½®è§„åˆ™:
  - åº”ç”¨å…¥å£: app/main.py
  - åº”ç”¨é…ç½®: app/core/config.py
  - æ•°æ®åº“é…ç½®: app/core/database.py
  - ä¾èµ–æ³¨å…¥: app/core/deps.py
  - å…±äº«å·¥å…·: app/shared/

ä¸¥é‡é”™è¯¯ä½ç½®:
  âŒ backend/app/          # ä¸å­˜åœ¨backendç›®å½•
  âŒ services/             # ä¸å­˜åœ¨servicesç›®å½•
```
### AIæ¨¡å—ç›¸å…³æ–‡ä»¶
```
AIæ¨¡å—æ–‡ä»¶ä½ç½®è§„åˆ™:
  - AIæ ¸å¿ƒæœåŠ¡: app/ai/services/
  - AI APIç«¯ç‚¹: app/ai/api/v1/
  - AIæ•°æ®æ¨¡å‹: app/ai/models/
  - AIè¯·æ±‚å“åº”æ¨¡å¼: app/ai/schemas/
  - AIæ¨¡å—æµ‹è¯•: tests/unit/ai/ æˆ– tests/integration/ai/
  - AIå·¥å…·å‡½æ•°: app/ai/utils/

ä¸¥é‡é”™è¯¯ä½ç½®:
  âŒ services/ai-service/          # å¾®æœåŠ¡ç›®å½•ä¸å­˜åœ¨
```
### ç”¨æˆ·æ¨¡å—ç›¸å…³æ–‡ä»¶
```
ç”¨æˆ·æ¨¡å—æ–‡ä»¶ä½ç½®è§„åˆ™:
  - ç”¨æˆ·æ ¸å¿ƒæœåŠ¡: app/users/services/
  - ç”¨æˆ·APIç«¯ç‚¹: app/users/api/v1/
  - ç”¨æˆ·æ•°æ®æ¨¡å‹: app/users/models/
  - ç”¨æˆ·æ¨¡å—æµ‹è¯•: tests/unit/users/
```
### è¯¾ç¨‹æ¨¡å—ç›¸å…³æ–‡ä»¶
```
è¯¾ç¨‹æ¨¡å—æ–‡ä»¶ä½ç½®è§„åˆ™:
  - è¯¾ç¨‹æ ¸å¿ƒæœåŠ¡: app/courses/services/
  - è¯¾ç¨‹APIç«¯ç‚¹: app/courses/api/v1/
  - è¯¾ç¨‹æ•°æ®æ¨¡å‹: app/courses/models/
  - è¯¾ç¨‹æ¨¡å—æµ‹è¯•: tests/unit/courses/
```
### è®­ç»ƒæ¨¡å—ç›¸å…³æ–‡ä»¶
```
è®­ç»ƒæ¨¡å—æ–‡ä»¶ä½ç½®è§„åˆ™:
  - è®­ç»ƒæ ¸å¿ƒæœåŠ¡: app/training/services/
  - è®­ç»ƒAPIç«¯ç‚¹: app/training/api/v1/
  - è®­ç»ƒæ•°æ®æ¨¡å‹: app/training/models/
  - è®­ç»ƒæ¨¡å—æµ‹è¯•: tests/unit/training/
```
## ğŸ” æ™ºèƒ½ä½“ç¼–ç æ£€æŸ¥æ¸…å•
### åˆ›å»ºæ–‡ä»¶å‰å¿…é¡»æ£€æŸ¥
### æ–‡ä»¶åˆ›å»ºå†³ç­–æ ‘
```
graph TD
    A[éœ€è¦åˆ›å»ºæ–‡ä»¶] --> B{ç¡®å®šä¸šåŠ¡é¢†åŸŸ}
    B -->|AIç›¸å…³| C[app/ai/]
    B -->|ç”¨æˆ·ç›¸å…³| D[app/users/]
    B -->|è¯¾ç¨‹ç›¸å…³| E[app/courses/]
    B -->|è®­ç»ƒç›¸å…³| F[app/training/]
    B -->|é€šçŸ¥ç›¸å…³| G[app/notifications/]
    B -->|åˆ†æç›¸å…³| H[app/analytics/]
    B -->|èµ„æºç›¸å…³| I[app/resources/]
    B -->|å‰ç«¯ç›¸å…³| J[frontend/]
```
## ğŸ“‹ å¸¸è§é”™è¯¯å’Œä¿®æ­£
### é”™è¯¯æ¨¡å¼1ï¼šæ¨¡å—æ··ä¹±
```
é”™è¯¯:
  - app/services/ai_service.py          # åº”è¯¥åœ¨å…·ä½“æ¨¡å—ä¸‹
  - app/models/user_model.py            # åº”è¯¥åœ¨å…·ä½“æ¨¡å—ä¸‹
  - tests/ai_service/test_ai.py         # åº”è¯¥åœ¨tests/unit/ai/ä¸‹

ä¿®æ­£:
  - app/ai/services/ai_service.py
  - app/users/models/user_model.py
  - tests/unit/ai/test_ai.py
```
### é”™è¯¯æ¨¡å¼2ï¼šæ¨¡å—è¾¹ç•Œä¸æ¸…
```
é”™è¯¯:
  - app/ai/services/user_service.py     # ç”¨æˆ·æœåŠ¡æ”¾åœ¨AIæ¨¡å—ä¸‹
  - app/users/services/ai_service.py    # AIæœåŠ¡æ”¾åœ¨ç”¨æˆ·æ¨¡å—ä¸‹

ä¿®æ­£:
  - app/users/services/user_service.py
  - app/ai/services/ai_service.py
```
### é”™è¯¯æ¨¡å¼3ï¼šæµ‹è¯•æ–‡ä»¶ä½ç½®é”™è¯¯
```
é”™è¯¯:
  - tests/ai_service/test_temperature.py    # åº”è¯¥æŒ‰æ¨¡å—ç»„ç»‡
  - app/ai/tests/test_ai_service.py         # æµ‹è¯•ä¸åº”è¯¥åœ¨æ¨¡å—å†…

ä¿®æ­£:
  - tests/unit/ai/test_temperature.py      # å•å…ƒæµ‹è¯•æŒ‰æ¨¡å—ç»„ç»‡
  - tests/integration/ai/test_ai_integration.py  # é›†æˆæµ‹è¯•æŒ‰æ¨¡å—ç»„ç»‡
```
## ğŸ› ï¸ æ™ºèƒ½ä½“å®æ–½æŒ‡å—
### 1. æ–‡ä»¶åˆ›å»ºå‰ç½®æ£€æŸ¥å‡½æ•°
```
def validate_file_path(file_path: str, content_type: str) -> bool:
    """
    éªŒè¯æ–‡ä»¶è·¯å¾„æ˜¯å¦ç¬¦åˆå¾®æœåŠ¡æ¶æ„è§„èŒƒ

    Args:
        file_path: è¦åˆ›å»ºçš„æ–‡ä»¶è·¯å¾„
        content_type: æ–‡ä»¶å†…å®¹ç±»å‹ (ai, user, course, training, notification)

    Returns:
        bool: è·¯å¾„æ˜¯å¦æ­£ç¡®
```
### 2. è‡ªåŠ¨æ¨¡å—æ£€æµ‹
```
def detect_module_from_content(content: str) -> str:
    """
    ä»æ–‡ä»¶å†…å®¹æ£€æµ‹åº”è¯¥å±äºå“ªä¸ªæ¨¡å—

    Args:
        content: æ–‡ä»¶å†…å®¹

    Returns:
        str: æ¨¡å—åç§°
    """
```
